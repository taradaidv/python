<!doctype html>
<html>
<head>

<meta charset="utf-8">
<title>Система передачи файлов</title>
<style type="text/css">
	


/* элемент с контентом */

h2 {
	color: #0079c2;	
}
	h3 {
	color: #0079c2;
	width: 100%;
	padding: 6px 20px 6px 70px;
	margin: 30px 10px 10px -71px;
	color: #fff;
	background-color: #0079c2;
	
}
.button{

	display: none;
  }
 
.file-upload {
	position: relative;
	overflow: hidden;
	background: #0079c2;
	color: #fff;
	text-align: center;
	font: 14px Arial, Helvetica, Times New Roman;
	height: 38px;
}

.file-upload:hover {
	background: #047ec8;
}
.file-upload input[type="file"]{
    display: none; 
}
.file-upload label {
     display: block;
     position: absolute;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     cursor: pointer;
}
.file-upload span {
     line-height: 36px; 
}

.pr {
	width: 99%;
	-webkit-box-shadow: 0px 0px;
	box-shadow: 0px 0px;
}


</style>
</head>
 
<body>
<noscript>
<meta http-equiv="refresh" content="0;URL=/ns">
JavaScript <b>отключен</b>, функционал ресурса доступен в ограниченном режиме.<br>
За более подробной информацией обратитесь к системному администратору.
</noscript>


<script type="text/javascript">


window.onload = function() {
	document.getElementById("I").innerHTML = '<img src="1.png" width="128" height="128" alt=""/>';
	
  };
  

function fileChange()
{
    if(!document.getElementById("FA").files)
        return;
   
    document.getElementById("upload").innerHTML ='<div class="file-upload"><label><input name="upload" type="button" class="button" onclick="uploadFile();" /><span>Отправить файл <b>'+document.getElementById("FA").files[0].name+'</b></span></label></div>';
    document.getElementById("PB").innerHTML ='<progress value="0" id="progress" class="pr" ></progress>';
    document.getElementById("text").innerHTML ="";
    document.getElementById("progress").value = 0;
    document.getElementById("I").innerHTML = '<img src="2.png" width="128" height="128" alt=""/>';


}

var client = null;


function uploadFile()
{
    
	var file = document.getElementById("FA").files[0];
	var formData = new FormData();

	client = new XMLHttpRequest();

	
    var prog = document.getElementById("progress");
 
    if(!file)
        return;
 
    prog.value = 0;
    prog.max = 100;
 
    
    formData.append("file", file);
 
    client.onerror = function(e) {
        alert("Ошибка");
    };
    
	 client.onloadend = function(e) {
		 
	
	};
    
	client.onreadystatechange = function(e) {
		document.getElementById("text").innerHTML =client.responseText;
    };
    
    client.onload = function(e) {
        prog.value = prog.max;
        document.getElementById("I").innerHTML = '<img src="3.png" width="128" height="128" alt=""/>';
		document.getElementById("cancel").innerHTML = "";
		document.getElementById("PB").innerHTML = "";
    };
 
    client.upload.onprogress = function(e) {
		var p = Math.round(100 / e.total * e.loaded);
        document.getElementById("progress").value = p;
	    if (p==100){
		    document.getElementById("text").innerHTML ="Ожидайте подтверждения ссылки";
	    }
       	
    };
	
	client.onabort = function(e) {
		alert("Передача файла "+document.getElementById("FA").files[0].name+" отменена");
		document.getElementById("cancel").innerHTML ="";
		document.getElementById("upload").innerHTML ="";
	};
 
 	
    client.open("POST", "upload");
    client.send(formData);
    document.getElementById("upload").innerHTML = "";
    document.getElementById("cancel").innerHTML = '<div class="file-upload"><label><input name="abort" type="button" class="button" onclick="uploadAbort();" /><span>Отменить отправку</span></label></div>';
    
}

function uploadAbort() {
	if(client instanceof XMLHttpRequest)
		client.abort();
}


</script>

<center>
	<h2>АВТОМАТИЗИРОВАННАЯ СИСТЕМА ПЕРЕДАЧИ ФАЙЛОВ</h2>
	<div id="I"></div>
	
<form action="" method="post" enctype="multipart/form-data">
<div class="file-upload">
<label>
<input type="file" name="file" onchange="fileChange();" id="FA">
<span>Выбрать файл</span>
</label>
</div>
</form>
<div id="PB"></div>
<div id="upload"></div>
<div id="cancel"></div>
</center>
<br>
<div id="text"></div>
</body>
</html>